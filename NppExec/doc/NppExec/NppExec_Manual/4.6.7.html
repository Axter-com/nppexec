<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1252">
<META NAME="Generator" CONTENT="Internet Assistant for Word Version 3.0">
<link href="style.css" rel="stylesheet" type="text/css">
<title>4.6.7. Run and terminate PowerShell process</title>
</HEAD>
<BODY>
<h3>4.6.7. Run and terminate PowerShell process</h3>

<p><em>[the following text is based on nppexec/issues/23]</em></p>
<p>The problem #1: If you execute a PowerShell's script in NppExec's Console, the PowerShell process is not ended when the script is finished.</p>
<p>The solution #1: Use &quot;cmd /c echo. | powershell&quot; instead of &quot;powershell&quot; to emulate sending of the Enter key to PowerShell process.</p>
<p>The problem #2: If a quoted file path is passed to the second instance of PowerShell, this second instance receives the file path without quotes.</p>
<p>The solution #2: Use escaped quotes \&quot; \&quot; instead of just &quot; &quot;.</p>
<p>Here is an example that illustrates this approach. Also it demonstrates how PowerShell's ExecutionPolicy can be applied to a single script. It is assumed that a .ps1 file is currently opened in Notepad++:</p>
<blockquote>
  <pre>cmd /c echo. | PowerShell -ExecutionPolicy Unrestricted start-process PowerShell -ArgumentList '-ExecutionPolicy Unrestricted -File \&quot;$(FULL_CURRENT_PATH)\&quot;'</pre>
</blockquote>

<p>And here is an example of PowerShell's command executed in NppExec's Console:</p>
<blockquote>
  <pre>cmd /c echo. | PowerShell -Command Write-Host 'Hello, World!'</pre>
</blockquote>

<blockquote>
  <pre> </pre>
</blockquote>

<p><em>[the text below was originally posted in NppExec's forum]</em></p>
<p>The problem: if you execute a PowerShell's script in NppExec's Console, the PowerShell process is not ended when the script is finished.</p>
<p>The solution: use &quot;cmd /c echo. | powershell&quot; instead of &quot;powershell&quot; to emulate sending of the Enter key to PowerShell process.</p>
<p>Here is an example of the full NppExec's script that uses the currently selected text as a PowerShell's program:</p>

<blockquote>
  <pre>// path to PowerShell.exe
set local PS_EXE = C:\WINDOWS\system32\windowspowershell\v1.0\powershell.exe
// temporary file
set local TEMP_FILE = $(SYS.TEMP)\ps_sel.ps1
// save selected text from current file to a temporary ANSI file
SEL_SAVETO $(TEMP_FILE) :a
// execute the temporary file in PowerShell and exit
cmd /c echo. | &quot;$(PS_EXE)&quot; -nologo &quot;$(TEMP_FILE)&quot;</pre>
</blockquote>

<p>Note:</p>
<p>If PowerShell unexpectedly says something like</p>
<blockquote>
  <pre>File &quot;test.ps1&quot; cannot be loaded because running scripts is disabled on this system</pre>
</blockquote>
<p>it could be related to the fact that there are 32-bit and 64-bit instances on 64-bit systems, and they can have different settings. According to https://stackoverflow.com/questions/4037939/powershell-says-execution-of-scripts-is-disabled-on-this-system , the following should help:</p>
<blockquote>
  <pre>x86 (32 bit)
Open &quot;C:\Windows\SysWOW64\cmd.exe&quot;
Run the command: &quot;powershell Set-ExecutionPolicy RemoteSigned&quot;

x64 (64 bit)
Open &quot;C:\Windows\system32\cmd.exe&quot;
Run the command: &quot;powershell Set-ExecutionPolicy RemoteSigned&quot;

You can check the bitness using
- In CMD: echo %PROCESSOR_ARCHITECTURE%
- In Powershell: [Environment]::Is64BitProcess
</pre>
</blockquote>

<p>See also: Using cmd.exe <a href="4.4.html">[4.4]</a>.</p>

</BODY>
</HTML>
